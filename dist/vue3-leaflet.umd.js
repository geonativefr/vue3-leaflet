(function(m,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","@vueuse/core"],e):(m=typeof globalThis!="undefined"?globalThis:m||self,e(m["vue3-leaflet"]={},m.Vue,m.core))})(this,function(m,e,l){"use strict";var we=Object.defineProperty;var P=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var T=(m,e,l)=>e in m?we(m,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[e]=l,C=(m,e)=>{for(var l in e||(e={}))_e.call(e,l)&&T(m,l,e[l]);if(P)for(var l of P(e))Le.call(e,l)&&T(m,l,e[l]);return m};const j="1.9.2",N="0.78.0",z="0.13.5",R="0.1.6",v="2.0.1",x="1.4.0",G="0.10.1",V="2.13.0";function O(t){return Object.assign(t,{render:()=>{}})}function A(t){return typeof t=="object"&&t!==null}function _(t){return A(t)&&Object.keys(t).forEach(n=>{if(A(t[n])){t[n]=_(t[n]);return}typeof t[n]=="undefined"&&(Array.isArray(t)?t.splice(n,1):delete t[n])}),t}async function I(t){var n;return window.gmapsApi=(n=window.gmapsApi)!=null?n:new Promise((r,a)=>{const o=document.createElement("script");o.type="text/javascript",o.src="https://maps.googleapis.com/maps/api/js?key="+t,o.async=!0,o.addEventListener("error",c=>a(c)),o.addEventListener("abort",c=>a(c)),o.addEventListener("load",()=>{r(!0)}),document.head.appendChild(o)}),window.gmapsApi}async function S(t){return new Promise((n,r)=>{if(document.querySelector(`script[src='${t}']`))return n();const o=document.createElement("script");o.type="text/javascript",o.src=t,o.addEventListener("error",c=>r(c)),o.addEventListener("abort",c=>r(c)),o.addEventListener("load",()=>n()),document.head.appendChild(o)})}async function b(t){return new Promise((n,r)=>{if(document.querySelector(`link[rel='stylesheet'][href='${t}']`))return n();const o=document.createElement("link");o.rel="stylesheet",o.href=t,o.crossOrigin="",o.addEventListener("error",c=>r(c)),o.addEventListener("abort",c=>r(c)),o.addEventListener("load",()=>n()),document.head.appendChild(o)})}async function q(t=V){return Promise.all([S(`https://unpkg.com/@geoman-io/leaflet-geoman-free@${t}/dist/leaflet-geoman.min.js`),b(`https://unpkg.com/@geoman-io/leaflet-geoman-free@${t}/dist/leaflet-geoman.css`)])}async function K(t=v){return S(`https://unpkg.com/leaflet.smooth_marker_bouncing@${t}/dist/bundle.js`)}async function E(t=j){await Promise.all([S(`https://unpkg.com/leaflet@${t}/dist/leaflet.js`),b(`https://unpkg.com/leaflet@${t}/dist/leaflet.css`)]),await Promise.all([K(),q()])}const F={__name:"MapContainer",props:{center:{type:[Array,Object],default:()=>{}},zoom:{type:Number,default:13},zoomControl:{type:Boolean,default:!0},scrollWheelZoom:{type:Boolean,default:!0},bounds:{type:Array,default:void 0},version:{type:String,default:void 0}},emits:["ready","move","zoomend"],setup(t,{emit:n}){const r=t,{center:a,zoom:o,zoomControl:c,bounds:d,scrollWheelZoom:u}=e.toRefs(r),g=e.reactive({scrollWheelZoom:u,maxZoom:18}),f=l.templateRef("container"),h=e.ref();function y(s,i){i.length>0&&s.fitBounds(i)}return e.provide("map",h),e.provide("leaflet.version",r.version),e.onMounted(async()=>{await E(r.version);const s=L.map(l.get(f),g);s.setView(r.center,r.zoom),e.watch(a,i=>s.setView(i)),e.watch(o,i=>s.setView(r.center,i),{immediate:!0}),e.watch(c,i=>i?s.zoomControl.addTo(s):s.zoomControl.remove(),{immediate:!0}),l.whenever(d,i=>y(s,i),{immediate:!0}),l.set(h,s),s.on("move",i=>n("move",{event:i,center:s.getCenter(),map:s})),s.on("zoomend",()=>n("zoomend",{zoom:s.getZoom(),bounds:s.getBounds(),map:s})),n("ready",s)}),(s,i)=>(e.openBlock(),e.createElementBlock("div",null,[(e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createElementVNode("div",e.mergeProps({ref_key:"container",ref:f},s.$attrs),[h.value?e.renderSlot(s.$slots,"default",{key:0,map:h.value}):e.createCommentVNode("",!0)],16)]),_:3}))]))}},U={__name:"OpenStreetMap",props:{url:{type:String,default:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"},attribution:{type:String,default:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'},type:{type:String,default:"roadmap",validator:t=>["roadmap"].includes(t)}},setup(t){const n=t,r=e.inject("map"),a=L.tileLayer(n.url,{attribution:n.attribution});return e.provide("layer",a),l.whenever(r,o=>o.addLayer(a),{immediate:!0}),(o,c)=>e.renderSlot(o.$slots,"default")}},Z={__name:"Mapbox",props:{url:{type:String,default:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token={apiKey}"},apiKey:{type:String,required:!0},attribution:{type:String,default:'&copy <a href="https://www.mapbox.com/about/maps/">Mapbox</a>&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> - <a href="https://www.mapbox.com/map-feedback/">Improve this map</a>'},tileSize:{type:Number,default:512},zoomOffset:{type:Number,default:-1},type:{type:String,default:"roadmap",validator:t=>["roadmap"].includes(t)}},async setup(t){let n,r;const a=t;[n,r]=e.withAsyncContext(()=>E(e.inject("leaflet.version"))),await n,r();const o=e.inject("map"),c=e.reactive({apiKey:a.apiKey,attribution:a.attribution,tileSize:a.tileSize,zoomOffset:a.zoomOffset}),d=L.tileLayer(a.url,c);return e.provide("layer",d),l.whenever(o,u=>u.addLayer(d),{immediate:!0}),(u,g)=>e.renderSlot(u.$slots,"default")}};async function D(t=z){return S(`https://unpkg.com/leaflet.gridlayer.googlemutant@${t}/dist/Leaflet.GoogleMutant.js`)}async function H(t){return window.gmapsApi?!0:S(`https://maps.googleapis.com/maps/api/js?key=${t}`)}const W={__name:"GoogleMaps",props:{url:{type:String,default:"https://mt0.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"},apiKey:{type:String,required:!0},type:{type:String,default:"roadmap",validator:t=>["roadmap","satellite","terrain","hybrid"].includes(t)},version:{type:String,default:void 0}},async setup(t){let n,r;const a=t;[n,r]=e.withAsyncContext(()=>E(e.inject("leaflet.version"))),await n,r(),[n,r]=e.withAsyncContext(()=>D(a.version)),await n,r();const{type:o}=e.toRefs(a),c=e.reactive({type:o}),d=i=>{const p=(k,$)=>L.gridLayer.googleMutant($).addTo(k);return{load:async(k,$=c)=>(await H(i),p(k,$),{})}},u=e.inject("map"),g=e.reactive({apiKey:a.apiKey,attribution:a.attribution,tileSize:a.tileSize,zoomOffset:a.zoomOffset}),f=L.tileLayer(a.url,g),h=d(a.apiKey),y=e.ref();e.watch(o,()=>s(e.unref(u)));async function s(i){l.set(y,await h.load(i,c))}return e.provide("layer",f),l.whenever(u,i=>s(i),{immediate:!0}),(i,p)=>y.value?e.renderSlot(i.$slots,"default",{key:0}):e.createCommentVNode("",!0)}},J=["data-marker"],Y={__name:"Marker",props:{position:{type:[Array,Object],required:!0},icon:{type:[String,Object],default:void 0},title:{type:String,default:void 0},alt:{type:String,default:void 0},opacity:{type:Number,default:void 0},tooltip:{type:String,default:void 0}},emits:["click","load"],async setup(t,{emit:n}){let r,a;const o=t;[r,a]=e.withAsyncContext(()=>E(e.inject("leaflet.version"))),await r,a(),L.Marker.prototype._animateZoom=function(p){if(!this._map)return;const w=this._map._latLngToNewLayerPoint(this._latlng,p.zoom,p.center).round();this._setPos(w)};const{position:c,title:d,alt:u,opacity:g}=e.toRefs(o),f=e.reactive({title:d,alt:u,opacity:g}),h=e.computed(()=>{if(o.icon instanceof L.Icon)return o.icon;if(o.icon instanceof Object)return L.icon(o.icon);if(typeof o.icon=="string"){const p={iconSize:[50,50],iconAnchor:[22,50],popupAnchor:[0,-50]};return L.icon(C({iconUrl:o.icon},p))}}),y=e.inject("map"),s=e.ref();e.provide("layer",s),e.provide("marker",s);function i(p){L.setOptions(p,_(f)),p._removeIcon(),p._initIcon(),p.update()}return e.onMounted(()=>{l.whenever(y,p=>{const w=L.marker(o.position,_(f));w.on("click",()=>n("click",w)),l.set(s,w),p.addLayer(l.get(s)),n("load",l.get(s)),l.whenever(c,k=>l.get(s).setLatLng(k)),l.whenever(h,k=>l.get(s).setIcon(k),{deep:!0,immediate:!0}),l.whenever(f,()=>i(l.get(s)),{deep:!0,immediate:!0})},{immediate:!0})}),e.onUnmounted(()=>l.get(s).remove()),(p,w)=>s.value?(e.openBlock(),e.createElementBlock("span",{key:0,"data-marker":s.value},[e.renderSlot(p.$slots,"default",{marker:s.value})],8,J)):e.createCommentVNode("",!0)}};function B(t,n){n?t.bounce():t.stopBouncing()}var Q={async mounted(t,n,r){const a=e.toRaw(r.props["data-marker"]);if(!(a instanceof L.Marker))throw Error("This directive can only be used on markers.");if(n.arg==="options"){a.setBouncingOptions(n.value);return}B(a,n.value)},async updated(t,n,r){const a=e.toRaw(r.props["data-marker"]);if(n.arg==="options"){a.setBouncingOptions(n.value);return}B(a,n.value)}},X=(t,n)=>{const r=t.__vccOpts||t;for(const[a,o]of n)r[a]=o;return r};if(document&&!document.getElementById("void")){const t=document.createElement("div");t.id="void",t.style.width=0,t.style.height=0,t.style.opacity=0,t.style.display="none",document.body.appendChild(t)}const ee={};function te(t,n,r,a,o,c){return e.openBlock(),e.createBlock(e.Teleport,{to:"#void"},[e.renderSlot(t.$slots,"default")])}var ne=X(ee,[["render",te]]);const oe={ref:"popup-content"},ae={__name:"Popup",props:{position:{type:[Object,Array],default:void 0}},async setup(t){let n,r;const a=t;[n,r]=e.withAsyncContext(()=>E(e.inject("leaflet.version"))),await n,r(),L.Popup.prototype._animateZoom=function(i){if(!this._map)return;const p=this._map._latLngToNewLayerPoint(this._latlng,i.zoom,i.center),w=this._getAnchor();L.DomUtil.setPosition(this._container,p.add(w))},window.fixPopupCloseEvent||(document.addEventListener("click",i=>{let p=i.target;for(;p!=null;){if(p.matches('a[href="#close"]')){i.preventDefault();return}p=p.parentElement}}),window.fixPopupCloseEvent=!0);const{position:o}=e.toRefs(a),c=l.templateRef("popup-content"),d=new L.Popup,u=e.inject("layer"),g=l.useMounted(),f=e.ref(!1);e.provide("layer",d);function h(){d.isOpen()&&(d.toggle(),d.toggle())}function y(){l.get(f)!==!0&&(l.get(u).bindPopup(d),l.set(f,!0),h())}function s(i){var w;if(l.get(g)===!1)return;const p=i.firstElementChild instanceof Element;i.innerHTML.trim().length>0&&(d.setContent(p?i.firstElementChild:i),y()),l.useMutationObserver((w=i.firstElementChild)!=null?w:i,()=>h(),{subtree:!0,childList:!0,characterData:!0})}return l.whenever(o,i=>d.setLatLng(i),{immediate:!0}),e.watch(c,s,{immediate:!0}),(i,p)=>(e.openBlock(),e.createBlock(ne,null,{default:e.withCtx(()=>[e.createElementVNode("div",oe,[e.renderSlot(i.$slots,"default")],512)]),_:3}))}};var re=O({props:{position:{type:[Array,Object],required:!0},text:{type:String,required:!0},direction:{type:String,default:"auto"},offset:{type:Object,default:void 0},permanent:{type:Boolean,default:!1},sticky:{type:Boolean,default:!1},opacity:{type:Number,default:.9}},setup(t){var d;const{position:n,text:r}=e.toRefs(t),a=e.reactive({direction:t.direction,offset:(d=t.offset)!=null?d:new L.Point(0,0),permanent:t.permanent,sticky:t.sticky,opacity:t.opacity}),o=e.inject("map"),c=u=>{const g=new L.Tooltip;g.setLatLng(t.position).addTo(u),e.watch(n,f=>g.setLatLng(f)),e.watch(r,f=>g.setContent(f),{immediate:!0}),e.watch(a,f=>L.setOptions(g,f),{immediate:!0})};l.whenever(o,c,{immediate:!0})}}),M={color:{type:String},weight:{type:Number},opacity:{type:Number},fillColor:{type:String}};const ie={__name:"Circle",props:C({center:{type:[Array,Object],required:!0},radius:{type:Number,required:!0}},M),setup(t){const n=t,{center:r,radius:a,color:o,weight:c,opacity:d,fillColor:u}=e.toRefs(n),g=e.computed(()=>n.color!=null),f=e.computed(()=>n.fillColor!=null),h=e.reactive({radius:a,stroke:g,color:o,weight:c,opacity:d,fill:f,fillColor:u}),y=e.inject("map"),s=L.circle(n.center,_(h));return e.provide("layer",s),l.whenever(y,i=>i.addLayer(s),{immediate:!0}),l.whenever(h,i=>L.setOptions(s,_(i),{deep:!0,immediate:!0})),l.whenever(r,i=>s.setLatLng(i)),e.onUnmounted(()=>s.remove()),(i,p)=>e.renderSlot(i.$slots,"default")}};async function se(t=G){return S(`https://unpkg.com/leaflet-geometryutil@${t}/src/leaflet.geometryutil.js`)}async function le(t=x){return await se(),S(`https://unpkg.com/leaflet-arrowheads@${t}/src/leaflet-arrowheads.js`)}const ce={__name:"Polyline",props:C({positions:{type:Array,required:!0},arrows:{type:Object,default:void 0}},M),async setup(t){let n,r;const a=t,{positions:o,color:c,weight:d,opacity:u,fillColor:g}=e.toRefs(a),f=e.computed(()=>a.color!=null),h=e.computed(()=>a.fillColor!=null),y=e.reactive({stroke:f,color:c,weight:d,opacity:u,fill:h,fillColor:g}),s=e.inject("map"),i=L.polyline(a.positions,_(y));return e.provide("layer",i),e.onUnmounted(()=>i.remove()),a.arrows&&([n,r]=e.withAsyncContext(()=>le()),await n,r(),i.arrowheads(a.arrows)),l.whenever(s,p=>p.addLayer(i),{immediate:!0}),l.whenever(y,p=>L.setOptions(i,_(p),{deep:!0,immediate:!0})),l.whenever(o,p=>i.setLatLngs(p)),(p,w)=>e.renderSlot(p.$slots,"default")}},pe={__name:"Polygon",props:C({positions:{type:Array,required:!0}},M),setup(t){const n=t,{positions:r,color:a,weight:o,opacity:c,fillColor:d}=e.toRefs(n),u=e.computed(()=>n.color!=null),g=e.computed(()=>n.fillColor!=null),f=e.reactive({stroke:u,color:a,weight:o,opacity:c,fill:g,fillColor:d}),h=e.inject("map"),y=L.polygon(n.positions,_(f));return e.provide("layer",y),l.whenever(h,s=>s.addLayer(y),{immediate:!0}),l.whenever(f,s=>L.setOptions(y,_(s),{deep:!0,immediate:!0})),l.whenever(r,s=>y.setLatLngs(s)),e.onUnmounted(()=>y.remove()),(s,i)=>e.renderSlot(s.$slots,"default")}};var de=O({props:{position:{type:String,default:void 0},zoomInTitle:{type:String,default:void 0},zoomOutTitle:{type:String,default:void 0}},setup(t){const n=e.inject("map"),r=new L.Control.Zoom(_(C({},t))),a=o=>{var c;(c=o==null?void 0:o.zoomControl)==null||c.remove(),o.addControl(r)};l.whenever(n,a,{immediate:!0})}}),me=O({props:{position:{type:String,default:void 0},maxWidth:{type:Number,default:void 0},imperial:{type:Boolean,default:void 0},metric:{type:Boolean,default:void 0}},async setup(t){const n=e.inject("map");await E(e.inject("leaflet.version"));const r=L.control.scale(_(C({},t)));l.whenever(n,a=>a.addControl(r),{immediate:!0})}});async function ue(t=N){return Promise.all([b(`https://unpkg.com/leaflet.locatecontrol@${t}/dist/L.Control.Locate.min.css`),S(`https://unpkg.com/leaflet.locatecontrol@${t}/dist/L.Control.Locate.min.js`)])}var fe=O({props:{position:{type:String,default:void 0},strings:{type:Object,default:void 0},version:{type:String,default:void 0}},async setup(t){const n=e.inject("map");await E(e.inject("leaflet.version")),await ue(t.version);const r=L.control.locate(_(C({},t)));l.whenever(n,a=>a.addControl(r),{immediate:!0})}});async function ye(t=R){return Promise.all([S(`https://unpkg.com/leaflet-pegman@${t}/leaflet-pegman.js`),b(`https://unpkg.com/leaflet-pegman@${t}/leaflet-pegman.css`)])}var ge=O({emits:["openstreetview","closestreetview"],props:{apiKey:{type:String,default:void 0},position:{type:String,default:"bottomright"},theme:{type:String,default:"leaflet-pegman-v3-small"},version:{type:String,default:void 0}},async setup(t,{emit:n}){const r=e.inject("map");t.apiKey&&await I(t.apiKey),await E(),await ye(t.version);const a=async o=>{new L.Control.Pegman({position:t.position,theme:t.theme}).addTo(o),new MutationObserver(u=>{var g,f;for(const h of u)if(h.type==="childList"){for(const y of h.addedNodes)(g=y.classList)!=null&&g.contains("pegman-marker")&&n("openstreetview");for(const y of h.removedNodes)(f=y.classList)!=null&&f.contains("pegman-marker")&&n("closestreetview")}}).observe(o._container,{childList:!0,subtree:!0})};l.whenever(r,a,{immediate:!0})}}),he=O({props:{locale:{type:String,default:"en"},onlyOneShape:{type:Boolean,default:!1},position:{type:String,default:"topright"},drawControls:{type:Boolean,default:!0},editControls:{type:Boolean,default:!1},drawPolygon:{type:Boolean,default:!1},drawCircle:{type:Boolean,default:!1},drawPolyline:{type:Boolean,default:!1},drawRectangle:{type:Boolean,default:!1},drawMarker:{type:Boolean,default:!1},drawCircleMarker:{type:Boolean,default:!1},drawText:{type:Boolean,default:!1},version:{type:String,default:void 0}},emits:["drawstart","drawend","cancel"],async setup(t,{emit:n}){const r=e.inject("map"),a=o=>{o.pm.addControls(C({},t)),o.pm.enableGlobalEditMode(),o.pm.enableGlobalRemovalMode(),o.pm.setLang(t.locale);const c=L.featureGroup();c.last=function(){return this.getLayers()[this.getLayers().length-1]},t.onlyOneShape&&(o.on("pm:create",d=>d.layer.addTo(c)),o.on("pm:drawstart",()=>{c.eachLayer(d=>d.removeFrom(o)),c.clearLayers()})),o.on("pm:drawstart",()=>n("drawstart")),o.on("pm:drawend",async d=>{await e.nextTick();const u=c.last();if(u===void 0){n("cancel");return}c.last()instanceof L.CircleMarker?n("drawend",{shape:d.shape,center:u.getLatLng(),radius:u.getRadius()}):n("drawend",{shape:d.shape,bounds:u.getLatLngs()})})};l.whenever(r,a,{immediate:!0})}});m.Circle=ie,m.DrawControl=he,m.GoogleMaps=W,m.LocateControl=fe,m.MapContainer=F,m.Mapbox=Z,m.Marker=Y,m.OpenStreetMap=U,m.PegmanControl=ge,m.Polygon=pe,m.Polyline=ce,m.Popup=ae,m.ScaleControl=me,m.Tooltip=re,m.ZoomControl=de,m.vBounce=Q,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
