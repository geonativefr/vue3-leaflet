(function(p,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","@vueuse/core"],e):(p=typeof globalThis!="undefined"?globalThis:p||self,e(p["vue3-leaflet"]={},p.Vue,p.core))})(this,function(p,e,i){"use strict";var we=Object.defineProperty;var $=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var T=(p,e,i)=>e in p?we(p,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[e]=i,E=(p,e)=>{for(var i in e||(e={}))Le.call(e,i)&&T(p,i,e[i]);if($)for(var i of $(e))_e.call(e,i)&&T(p,i,e[i]);return p};const j="1.9.2",N="0.78.0",v="0.13.5",z="0.1.6",R="2.0.1",x="1.4.0",G="0.10.1",V="2.13.0";function S(t){return Object.assign(t,{render:()=>{}})}function B(t){return typeof t=="object"&&t!==null}function w(t){return B(t)&&Object.keys(t).forEach(o=>{if(B(t[o])){t[o]=w(t[o]);return}typeof t[o]=="undefined"&&(Array.isArray(t)?t.splice(o,1):delete t[o])}),t}async function I(t){var o;return window.gmapsApi=(o=window.gmapsApi)!=null?o:new Promise((r,a)=>{const n=document.createElement("script");n.type="text/javascript",n.src="https://maps.googleapis.com/maps/api/js?key="+t,n.async=!0,n.addEventListener("error",l=>a(l)),n.addEventListener("abort",l=>a(l)),n.addEventListener("load",()=>{r(!0)}),document.head.appendChild(n)}),window.gmapsApi}async function C(t){return new Promise((o,r)=>{if(document.querySelector(`script[src='${t}']`))return o();const n=document.createElement("script");n.type="text/javascript",n.src=t,n.addEventListener("error",l=>r(l)),n.addEventListener("abort",l=>r(l)),n.addEventListener("load",()=>o()),document.head.appendChild(n)})}async function b(t){return new Promise((o,r)=>{if(document.querySelector(`link[rel='stylesheet'][href='${t}']`))return o();const n=document.createElement("link");n.rel="stylesheet",n.href=t,n.crossOrigin="",n.addEventListener("error",l=>r(l)),n.addEventListener("abort",l=>r(l)),n.addEventListener("load",()=>o()),document.head.appendChild(n)})}async function q(t=V){return Promise.all([C(`https://unpkg.com/@geoman-io/leaflet-geoman-free@${t}/dist/leaflet-geoman.min.js`),b(`https://unpkg.com/@geoman-io/leaflet-geoman-free@${t}/dist/leaflet-geoman.css`)])}async function K(t=R){return C(`https://unpkg.com/leaflet.smooth_marker_bouncing@${t}/dist/bundle.js`)}async function k(t=j){await Promise.all([C(`https://unpkg.com/leaflet@${t}/dist/leaflet.js`),b(`https://unpkg.com/leaflet@${t}/dist/leaflet.css`)]),await Promise.all([K(),q()])}const F={__name:"MapContainer",props:{center:{type:[Array,Object],default:()=>{}},zoom:{type:Number,default:13},zoomControl:{type:Boolean,default:!0},scrollWheelZoom:{type:Boolean,default:!0},bounds:{type:Array,default:void 0},version:{type:String,default:void 0}},emits:["ready","move","zoomend"],setup(t,{emit:o}){const r=t,{center:a,zoom:n,zoomControl:l,bounds:d,scrollWheelZoom:f}=e.toRefs(r),h=e.reactive({scrollWheelZoom:f,maxZoom:18}),y=i.templateRef("container"),m=e.ref();function u(s,c){c.length>0&&s.fitBounds(c)}return e.provide("map",m),e.provide("leaflet.version",r.version),e.onMounted(async()=>{await k(r.version);const s=L.map(i.get(y),h);s.setView(r.center,r.zoom),e.watch(a,c=>s.setView(c)),e.watch(n,c=>s.setView(r.center,c),{immediate:!0}),e.watch(l,c=>c?s.zoomControl.addTo(s):s.zoomControl.remove(),{immediate:!0}),i.whenever(d,c=>u(s,c),{immediate:!0}),i.set(m,s),s.on("move",c=>o("move",{event:c,center:s.getCenter(),map:s})),s.on("zoomend",()=>o("zoomend",{zoom:s.getZoom(),bounds:s.getBounds(),map:s})),o("ready",s)}),(s,c)=>(e.openBlock(),e.createElementBlock("div",null,[(e.openBlock(),e.createBlock(e.Suspense,null,{default:e.withCtx(()=>[e.createElementVNode("div",e.mergeProps({ref_key:"container",ref:y},s.$attrs),[m.value?e.renderSlot(s.$slots,"default",{key:0,map:m.value}):e.createCommentVNode("",!0)],16)]),_:3}))]))}},U={__name:"OpenStreetMap",props:{url:{type:String,default:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"},attribution:{type:String,default:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'},type:{type:String,default:"roadmap",validator:t=>["roadmap"].includes(t)}},setup(t){const o=t,r=e.inject("map"),a=L.tileLayer(o.url,{attribution:o.attribution});return e.provide("layer",a),i.whenever(r,n=>n.addLayer(a),{immediate:!0}),(n,l)=>e.renderSlot(n.$slots,"default")}},Z={__name:"Mapbox",props:{url:{type:String,default:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token={apiKey}"},apiKey:{type:String,required:!0},attribution:{type:String,default:'&copy <a href="https://www.mapbox.com/about/maps/">Mapbox</a>&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> - <a href="https://www.mapbox.com/map-feedback/">Improve this map</a>'},tileSize:{type:Number,default:512},zoomOffset:{type:Number,default:-1},type:{type:String,default:"roadmap",validator:t=>["roadmap"].includes(t)}},async setup(t){let o,r;const a=t;[o,r]=e.withAsyncContext(()=>k(e.inject("leaflet.version"))),await o,r();const n=e.inject("map"),l=e.reactive({apiKey:a.apiKey,attribution:a.attribution,tileSize:a.tileSize,zoomOffset:a.zoomOffset}),d=L.tileLayer(a.url,l);return e.provide("layer",d),i.whenever(n,f=>f.addLayer(d),{immediate:!0}),(f,h)=>e.renderSlot(f.$slots,"default")}};async function D(t=v){return C(`https://unpkg.com/leaflet.gridlayer.googlemutant@${t}/dist/Leaflet.GoogleMutant.js`)}async function H(t){return window.gmapsApi?!0:C(`https://maps.googleapis.com/maps/api/js?key=${t}`)}const W={__name:"GoogleMaps",props:{url:{type:String,default:"https://mt0.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"},apiKey:{type:String,required:!0},type:{type:String,default:"roadmap",validator:t=>["roadmap","satellite","terrain","hybrid"].includes(t)},version:{type:String,default:void 0}},async setup(t){let o,r;const a=t;[o,r]=e.withAsyncContext(()=>k(e.inject("leaflet.version"))),await o,r(),[o,r]=e.withAsyncContext(()=>D(a.version)),await o,r();const{type:n}=e.toRefs(a),l=e.reactive({type:n}),d=c=>{const g=(O,A)=>L.gridLayer.googleMutant(A).addTo(O);return{load:async(O,A=l)=>(await H(c),g(O,A),{})}},f=e.inject("map"),h=e.reactive({apiKey:a.apiKey,attribution:a.attribution,tileSize:a.tileSize,zoomOffset:a.zoomOffset}),y=L.tileLayer(a.url,h),m=d(a.apiKey),u=e.ref();e.watch(n,()=>s(e.unref(f)));async function s(c){i.set(u,await m.load(c,l))}return e.provide("layer",y),i.whenever(f,c=>s(c),{immediate:!0}),(c,g)=>u.value?e.renderSlot(c.$slots,"default",{key:0}):e.createCommentVNode("",!0)}},J=["data-marker"],Y={__name:"Marker",props:{position:{type:[Array,Object],required:!0},icon:{type:[String,Object],default:void 0},title:{type:String,default:void 0},alt:{type:String,default:void 0},opacity:{type:Number,default:void 0},tooltip:{type:String,default:void 0}},emits:["click","load"],async setup(t,{emit:o}){let r,a;const n=t;[r,a]=e.withAsyncContext(()=>k(e.inject("leaflet.version"))),await r,a(),L.Marker.prototype._animateZoom=function(g){if(!this._map)return;const _=this._map._latLngToNewLayerPoint(this._latlng,g.zoom,g.center).round();this._setPos(_)};const{position:l,title:d,alt:f,opacity:h}=e.toRefs(n),y=e.reactive({title:d,alt:f,opacity:h}),m=e.computed(()=>{if(n.icon instanceof L.Icon)return n.icon;if(n.icon instanceof Object)return L.icon(n.icon);if(typeof n.icon=="string"){const g={iconSize:[50,50],iconAnchor:[22,50],popupAnchor:[0,-50]};return L.icon(E({iconUrl:n.icon},g))}}),u=e.inject("map"),s=e.ref();e.provide("layer",s),e.provide("marker",s);function c(g){L.setOptions(g,w(y)),g._removeIcon(),g._initIcon(),g.update()}return e.onMounted(()=>{i.whenever(u,g=>{const _=L.marker(n.position,w(y));_.on("click",()=>o("click",_)),i.set(s,_),g.addLayer(i.get(s)),o("load",i.get(s)),i.whenever(l,O=>i.get(s).setLatLng(O)),i.whenever(m,O=>i.get(s).setIcon(O),{deep:!0,immediate:!0}),i.whenever(y,()=>c(i.get(s)),{deep:!0,immediate:!0})},{immediate:!0})}),e.onUnmounted(()=>i.get(s).remove()),(g,_)=>s.value?(e.openBlock(),e.createElementBlock("span",{key:0,"data-marker":s.value},[e.renderSlot(g.$slots,"default",{marker:s.value})],8,J)):e.createCommentVNode("",!0)}};function P(t,o){o?t.bounce():t.stopBouncing()}var Q={async mounted(t,o,r){const a=e.toRaw(r.props["data-marker"]);if(!(a instanceof L.Marker))throw Error("This directive can only be used on markers.");if(o.arg==="options"){a.setBouncingOptions(o.value);return}P(a,o.value)},async updated(t,o,r){const a=e.toRaw(r.props["data-marker"]);if(o.arg==="options"){a.setBouncingOptions(o.value);return}P(a,o.value)}},X=(t,o)=>{const r=t.__vccOpts||t;for(const[a,n]of o)r[a]=n;return r};if(document&&!document.getElementById("void")){const t=document.createElement("div");t.id="void",t.style.width=0,t.style.height=0,t.style.opacity=0,t.style.display="none",document.body.appendChild(t)}const ee={};function te(t,o,r,a,n,l){return e.openBlock(),e.createBlock(e.Teleport,{to:"#void"},[e.renderSlot(t.$slots,"default")])}var ne=X(ee,[["render",te]]);const oe={ref:"popup-content"},ae={__name:"Popup",props:{position:{type:[Object,Array],default:void 0}},async setup(t){let o,r;const a=t;[o,r]=e.withAsyncContext(()=>k(e.inject("leaflet.version"))),await o,r(),L.Popup.prototype._animateZoom=function(c){if(!this._map)return;const g=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center),_=this._getAnchor();L.DomUtil.setPosition(this._container,g.add(_))},window.fixPopupCloseEvent||(document.addEventListener("click",c=>{let g=c.target;for(;g!=null;){if(g.matches('a[href="#close"]')){c.preventDefault();return}g=g.parentElement}}),window.fixPopupCloseEvent=!0);const{position:n}=e.toRefs(a),l=i.templateRef("popup-content"),d=new L.Popup,f=e.inject("layer"),h=i.useMounted(),y=e.ref(!1);e.provide("layer",d);function m(){d.isOpen()&&(d.toggle(),d.toggle())}function u(){i.get(y)!==!0&&(i.get(f).bindPopup(d),i.set(y,!0),m())}function s(c){var _;if(i.get(h)===!1)return;const g=c.firstElementChild instanceof Element;c.innerHTML.trim().length>0&&(d.setContent(g?c.firstElementChild:c),u()),i.useMutationObserver((_=c.firstElementChild)!=null?_:c,()=>m(),{subtree:!0,childList:!0,characterData:!0})}return i.whenever(n,c=>d.setLatLng(c),{immediate:!0}),e.watch(l,s,{immediate:!0}),(c,g)=>(e.openBlock(),e.createBlock(ne,null,{default:e.withCtx(()=>[e.createElementVNode("div",oe,[e.renderSlot(c.$slots,"default")],512)]),_:3}))}};var re=S({props:{position:{type:[Array,Object],required:!0},text:{type:String,required:!0},direction:{type:String,default:"auto"},offset:{type:Object,default:void 0},permanent:{type:Boolean,default:!1},sticky:{type:Boolean,default:!1},opacity:{type:Number,default:.9}},setup(t){var d;const{position:o,text:r}=e.toRefs(t),a=e.reactive({direction:t.direction,offset:(d=t.offset)!=null?d:new L.Point(0,0),permanent:t.permanent,sticky:t.sticky,opacity:t.opacity}),n=e.inject("map"),l=f=>{const h=new L.Tooltip;h.setLatLng(t.position).addTo(f),e.watch(o,y=>h.setLatLng(y)),e.watch(r,y=>h.setContent(y),{immediate:!0}),e.watch(a,y=>L.setOptions(h,y),{immediate:!0})};i.whenever(n,l,{immediate:!0})}}),M={color:{type:String},weight:{type:Number},opacity:{type:Number},fillColor:{type:String}},ie=S({props:E({center:{type:[Array,Object],required:!0},radius:{type:Number,required:!0}},M),setup(t){const{center:o,radius:r,color:a,weight:n,opacity:l,fillColor:d}=e.toRefs(t),f=e.computed(()=>t.color!=null),h=e.computed(()=>t.fillColor!=null),y=e.reactive({radius:r,stroke:f,color:a,weight:n,opacity:l,fill:h,fillColor:d}),m=e.inject("map"),u=L.circle(t.center,w(y));e.provide("layer",u),i.whenever(m,s=>s.addLayer(u),{immediate:!0}),i.whenever(y,s=>L.setOptions(u,w(s),{deep:!0,immediate:!0})),i.whenever(o,s=>u.setLatLng(s)),e.onUnmounted(()=>u.remove())}});async function se(t=G){return C(`https://unpkg.com/leaflet-geometryutil@${t}/src/leaflet.geometryutil.js`)}async function le(t=x){return await se(),C(`https://unpkg.com/leaflet-arrowheads@${t}/src/leaflet-arrowheads.js`)}var ce=S({props:E({positions:{type:Array,required:!0},arrows:{type:Object,default:void 0}},M),async setup(t){const{positions:o,color:r,weight:a,opacity:n,fillColor:l}=e.toRefs(t),d=e.computed(()=>t.color!=null),f=e.computed(()=>t.fillColor!=null),h=e.reactive({stroke:d,color:r,weight:a,opacity:n,fill:f,fillColor:l}),y=e.inject("map"),m=L.polyline(t.positions,w(h));e.provide("layer",m),e.onUnmounted(()=>m.remove()),t.arrows&&(await le(),m.arrowheads(t.arrows)),i.whenever(y,u=>u.addLayer(m),{immediate:!0}),i.whenever(h,u=>L.setOptions(m,w(u),{deep:!0,immediate:!0})),i.whenever(o,u=>m.setLatLngs(u))}}),de=S({props:E({positions:{type:Array,required:!0}},M),setup(t){const{positions:o,color:r,weight:a,opacity:n,fillColor:l}=e.toRefs(t),d=e.computed(()=>t.color!=null),f=e.computed(()=>t.fillColor!=null),h=e.reactive({stroke:d,color:r,weight:a,opacity:n,fill:f,fillColor:l}),y=e.inject("map"),m=L.polygon(t.positions,w(h));e.provide("layer",m),i.whenever(y,u=>u.addLayer(m),{immediate:!0}),i.whenever(h,u=>L.setOptions(m,w(u),{deep:!0,immediate:!0})),i.whenever(o,u=>m.setLatLngs(u)),e.onUnmounted(()=>m.remove())}}),pe=S({props:{position:{type:String,default:void 0},zoomInTitle:{type:String,default:void 0},zoomOutTitle:{type:String,default:void 0}},setup(t){const o=e.inject("map"),r=new L.Control.Zoom(w(E({},t))),a=n=>{var l;(l=n==null?void 0:n.zoomControl)==null||l.remove(),n.addControl(r)};i.whenever(o,a,{immediate:!0})}}),me=S({props:{position:{type:String,default:void 0},maxWidth:{type:Number,default:void 0},imperial:{type:Boolean,default:void 0},metric:{type:Boolean,default:void 0}},async setup(t){const o=e.inject("map");await k(e.inject("leaflet.version"));const r=L.control.scale(w(E({},t)));i.whenever(o,a=>a.addControl(r),{immediate:!0})}});async function ue(t=N){return Promise.all([b(`https://unpkg.com/leaflet.locatecontrol@${t}/dist/L.Control.Locate.min.css`),C(`https://unpkg.com/leaflet.locatecontrol@${t}/dist/L.Control.Locate.min.js`)])}var fe=S({props:{position:{type:String,default:void 0},strings:{type:Object,default:void 0},version:{type:String,default:void 0}},async setup(t){const o=e.inject("map");await k(e.inject("leaflet.version")),await ue(t.version);const r=L.control.locate(w(E({},t)));i.whenever(o,a=>a.addControl(r),{immediate:!0})}});async function ye(t=z){return Promise.all([C(`https://unpkg.com/leaflet-pegman@${t}/leaflet-pegman.js`),b(`https://unpkg.com/leaflet-pegman@${t}/leaflet-pegman.css`)])}var ge=S({emits:["openstreetview","closestreetview"],props:{apiKey:{type:String,default:void 0},position:{type:String,default:"bottomright"},theme:{type:String,default:"leaflet-pegman-v3-small"},version:{type:String,default:void 0}},async setup(t,{emit:o}){const r=e.inject("map");t.apiKey&&await I(t.apiKey),await k(),await ye(t.version);const a=async n=>{new L.Control.Pegman({position:t.position,theme:t.theme}).addTo(n),new MutationObserver(f=>{var h,y;for(const m of f)if(m.type==="childList"){for(const u of m.addedNodes)(h=u.classList)!=null&&h.contains("pegman-marker")&&o("openstreetview");for(const u of m.removedNodes)(y=u.classList)!=null&&y.contains("pegman-marker")&&o("closestreetview")}}).observe(n._container,{childList:!0,subtree:!0})};i.whenever(r,a,{immediate:!0})}}),he=S({props:{locale:{type:String,default:"en"},onlyOneShape:{type:Boolean,default:!1},position:{type:String,default:"topright"},drawControls:{type:Boolean,default:!0},editControls:{type:Boolean,default:!1},drawPolygon:{type:Boolean,default:!1},drawCircle:{type:Boolean,default:!1},drawPolyline:{type:Boolean,default:!1},drawRectangle:{type:Boolean,default:!1},drawMarker:{type:Boolean,default:!1},drawCircleMarker:{type:Boolean,default:!1},drawText:{type:Boolean,default:!1},version:{type:String,default:void 0}},emits:["drawstart","drawend","cancel"],async setup(t,{emit:o}){const r=e.inject("map"),a=n=>{n.pm.addControls(E({},t)),n.pm.enableGlobalEditMode(),n.pm.enableGlobalRemovalMode(),n.pm.setLang(t.locale);const l=L.featureGroup();l.last=function(){return this.getLayers()[this.getLayers().length-1]},t.onlyOneShape&&(n.on("pm:create",d=>d.layer.addTo(l)),n.on("pm:drawstart",()=>{l.eachLayer(d=>d.removeFrom(n)),l.clearLayers()})),n.on("pm:drawstart",()=>o("drawstart")),n.on("pm:drawend",async d=>{await e.nextTick();const f=l.last();if(f===void 0){o("cancel");return}l.last()instanceof L.CircleMarker?o("drawend",{shape:d.shape,center:f.getLatLng(),radius:f.getRadius()}):o("drawend",{shape:d.shape,bounds:f.getLatLngs()})})};i.whenever(r,a,{immediate:!0})}});p.Circle=ie,p.DrawControl=he,p.GoogleMaps=W,p.LocateControl=fe,p.MapContainer=F,p.Mapbox=Z,p.Marker=Y,p.OpenStreetMap=U,p.PegmanControl=ge,p.Polygon=de,p.Polyline=ce,p.Popup=ae,p.ScaleControl=me,p.Tooltip=re,p.ZoomControl=pe,p.vBounce=Q,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
